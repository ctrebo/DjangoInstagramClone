{% extends "base_generic.html" %}

{% block content %}
{% for post in post_list %}
    <div class="row mb-3 mb-3 mb-md-5">
        <div class="col-12 col-md-7 p-0 p-md-2">
            <section class="border-post">
                <section>
                    <header class="px-3 p-075 bg-white">
                        <article>
                            <a href="{% url 'user-detail' post.author.pk %}"><img class="post-pp img-fluid"  src="{{post.author.prof_pic.url}}" alt="alt"></a>
                            <span class="ml-2 font-size-username">
                                <a class="text-dark" href="{% url 'user-detail' post.author.pk %}"><b>{{post.author.username}}</b></a>
                            </span>
                            <span class="float-right" data-toggle="modal" data-target="#modal-{{post.pk}}">
                                <i class="fa fa-circle font-size-05" aria-hidden=""></i><i class="fa fa-circle font-size-05 margin-015rem" aria-hidden="true"></i><i class="fa fa-circle font-size-05" aria-hidden="true"></i>
                            </span>
                            <!-- Modal -->
                            <div class="modal fade" id="modal-{{post.pk}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                <div class="modal-content modal-content-post-setting">
                                    <div class="modal-body px-0">
                                        <section class="px-3">
                                            <article><a class="w-100 d-block text-dark text-decoration-none text-center" href=" {% url 'create-comment' post.pk %}">View post</a></article>
                                        </section>
                                        <hr>
                                        <section class="px-3">
                                            {% url 'create-comment' post.pk as url_to_copy %}
                                            {% with full_url=request.META.HTTP_HOST|add:url_to_copy %}
                                            <article><p data-dismiss="modal" class="w-100 d-block text-dark text-decoration-none text-center cursor-pointer" onclick='copyToClipboard("{{full_url}}")'>Copy link</p></article>
                                            {% endwith %}
                                        </section>
                                        <hr>
                                        <section class="px-3">
                                            <article><a data-dismiss="modal" class="w-100 d-block text-dark text-decoration-none text-center" href="">Abort</a></article>
                                        </section>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </article>
                    </header>
                </section>
                <section class="position-relative">
                    <article>
                        <img class="w-100 h-auto img-fluid"  src="{{post.picture.url}}" alt="alt">
                        {% if post.tagged_people.exists %}
                            <div class="tagged-people" data-toggle="modal" data-target="#modaltagged-{{post.pk}}"><i class="fa text-white fa-user tagged-people-icon"></i></div>
                            <div class="modal fade" id="modaltagged-{{post.pk}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h5 class="modal-title" id="exampleModalLongTitle">In this Post</h5>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                                    <div class="modal-body">
                                      {% for user in post.tagged_people.all %}
                                        <a href="{% url 'user-detail' user.pk %}" class="">
                                            <section class="position-relative mb-1 section-search-page px-2 py-2">
                                                <div>
                                                    <article class="d-inline my-auto ">
                                                        <img src="{{user.prof_pic.url}}" class="post-pp img-fluid">
                                                    </article>
                                                    <article class="d-inline search-article">
                                                        <div>
                                                            <b class="username-search text-dark">{{user.username}}</b>
                                                        </div>
                                                        <small class="font-weight-light text-dark">{{user.first_name}}</small>
                                                    </article>
                                                </div>
                                            </section>
                                        </a>
                                      {% endfor %}
                                    </div>
                                  </div>
                                </div>
                              </div>

                        {% endif %}
                    </article>
                </section>
                <section class="px-3 bg-white">
                    <article class="py-2">
                        {% load insta_extras %}
                        <form action="{% url 'like-post-for-list-view' post.pk %}" class="d-inline like-form" method="POST">
                            {% csrf_token %}
                            <button type="submit" name="post_id" value="{{post.pk}}" class="btn bg-white px-0 like-submit-bottom-home"><i class="fa fa-15 fa-heart {% if user in post.likes.all %} text-danger {% else %} text-white fontawesome-border {% endif %} "></i></button>
                        </form>
                        <a class="px-2" href="{% url 'create-comment' post.pk %}"><i class="fa fa-15 fa-comment fontawesome-border text-white"></i></a>
                        <form class='float-right' action="{% url 'save-post' post.pk %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" name="redirect_path" value="{% url 'index' %}" class="btn bg-white"><i class="fa fa-15 fa-bookmark{% if post in user.saved_posts.all %} text-dark{% else %} text-white fontawesome-border{% endif %}"></i></button>
                        </form>
                    </article>
                </section>
                <section class="px-3">
                    <article>
                        <span class="font-size-username">
                            <b><a class="text-dark" href="{% url 'user-detail' post.author.pk %}">{{post.author.username}}</a></b><span>&nbsp</span><span>{{post.caption}}</span>
                        </span>
                    </article>
                </section>
                <section class="px-3">
                    <article>
                        {% if post.postcomment_set.count > 1 %}
                        <p class="mb-1 mt-1"><a class="comment-post text-decoration-none" href="{% url 'create-comment' post.pk %}">Show all {{post.postcomment_set.count}} comments</a></p>
                        {% endif %}
                        {% if post.postcomment_set.all %}
                        <span class="font-size-username">
                            {% with first_comment=post.postcomment_set.all|first %}
                            <b><a href="{% if first_comment.author == user %}  {% url 'profpage-user'  %} {% else %} {% url 'user-detail' first_comment.author.pk %} {% endif %}" class="text-dark">{{first_comment.author.username}}</a></b>
                            <span>&nbsp</span><span>{% for word in first_comment.description_to_array %}{% if "@" in word %} <a href="{% get_tagged_user word user %}">{{word}}  </a> {% else %}{{word}} {% endif %}{% endfor %}</span>
                            {% endwith %}
                        </span>
                        {% endif %}

                    </article>
                </section>
                <section class="px-3">
                    <article class="">
                        <p class="time-ago">{{post.time_posted_ago}}</p>
                    </article>
                </section>
            </section>

        </div>

    </div>
    {% if forloop.first %}
    <div class="col-md-5 d-none d-md-block recommendations-fixed">
        <section class="vh-100">
            <article>
                <div class="py-4">
                    <p class="font-weight-light mb-4">Recommandations for you</p>
                    {% for user in recommandation_list %}
                    <div class="mb-3">
                        <table class="w-100">
                            <tr>
                                <td class="w-10"><a href="{% url 'user-detail' user.pk %}"><img class="post-pp img-fluid" src="{{user.prof_pic.url}}"></a></td>
                                <td class="w-50"><b><a class="text-dark" href="{% url 'user-detail' user.pk %}">{{user.username}}</a></b></td>
                                <td>
                                    <form action="{% url 'follow-user' user.pk %}" method="POST">
                                        {% csrf_token %}

                                        <button class="bg-white border-0 text-info" type="submit" name="redirect_path" value="{% url 'user-detail' user.pk %}">Follow</button>
                                    </form>
                                </td>
                            </tr>
                        </table>
                    </div>
                    {% endfor %}
                </div>
            </article>
        </section>
    </div>
    {% endif %}
    {% empty %}
    <div class="col-md-5 d-none d-md-block recommendations-fixed">
        <section class="vh-100">
            <article>
                <div class="py-4">
                    <p class="font-weight-light mb-4">Recommandations for you</p>

                    {% for user in recommandation_list %}
                    <div class="mb-3">

                        <table class="w-100">
                            <tr>
                                <td class="w-10"><a href="{% url 'user-detail' user.pk %}"><img class="post-pp img-fluid" src="{{user.prof_pic.url}}"></a></td>
                                <td class="w-50"><b><a class="text-dark" href="{% url 'user-detail' user.pk %}">{{user.username}}</a></b></td>
                                <td>
                                    <form action="{% url 'follow-user' user.pk %}" method="POST">
                                        {% csrf_token %}

                                        <button class="bg-white border-0 text-info" type="submit" name="redirect_path" value="{% url 'user-detail' user.pk %}">Follow</button>
                                    </form>
                                </td>
                            </tr>
                        </table>
                    </div>
                    {% endfor %}
                </div>
            </article>
        </section>
    </div>
{% endfor %}
{% endblock %}
